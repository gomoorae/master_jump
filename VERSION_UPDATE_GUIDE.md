# 무혼 비동 - 버전 업데이트 가이드 📦

## 현재 버전: v1.0.1

게임을 업데이트할 때마다 **반드시** 이 파일의 절차를 따라주세요!

---

## 🚀 업데이트 절차 (3단계만 기억하세요!)

### 1️⃣ 버전 번호 결정
- 작은 수정: `v1.0.1` → `v1.0.2` (마지막 숫자만 증가)
- 기능 추가: `v1.0.1` → `v1.1.0` (중간 숫자 증가)
- 대규모 변경: `v1.0.1` → `v2.0.0` (첫 번째 숫자 증가)

### 2️⃣ 다음 3개 파일의 버전 번호 수정

#### 📄 `service-worker.js` (3번째 줄)
```javascript
const VERSION = 'v1.0.2';  // ← 이 부분만 수정!
```

#### 📄 `manifest.json` (3번째 줄)
```json
"version": "1.0.2",  // ← 이 부분만 수정!
"start_url": "./index.html?v=1.0.2",  // ← 여기도 수정!
```

#### 📄 모든 HTML 파일 (6번째 줄) - **9개 파일**
```html
<meta name="version" content="1.0.2">  // ← 이 부분만 수정!
```

**수정해야 할 HTML 파일 목록:**
- ✅ `index.html`
- ✅ `stage_1.html`
- ✅ `stage_2.html`
- ✅ `stage_3.html`
- ✅ `stage_final.html`
- ✅ `rest_area_1.html`
- ✅ `rest_area_2.html`
- ✅ `rest_area_3.html`
- ✅ `ending.html`

### 3️⃣ 서버에 업로드 및 테스트

1. **수정된 파일들을 서버에 업로드**
2. **스마트폰에서 테스트:**
   - 게임 실행
   - 콘솔 로그 확인: `[Service Worker v1.0.2] 초기화` 메시지 확인
   - 3초 후 자동으로 새로고침되면 성공!

---

## 🔧 자동 캐시 무효화 시스템 작동 원리

### ✅ 구현된 기능:

1. **HTML 파일 네트워크 우선 전략**
   - 모든 HTML 파일은 항상 서버에서 최신 버전 확인
   - 오프라인일 때만 캐시 사용

2. **Service Worker 자동 업데이트**
   - 1시간마다 자동으로 업데이트 확인
   - 새 버전 감지 시 3초 후 자동 새로고침

3. **리소스 스마트 캐싱**
   - 이미지, 폰트, 오디오: 캐시 우선 + 백그라운드 업데이트
   - 동영상: 네트워크 우선 (용량 고려)

4. **캐시 버전 관리**
   - 버전 변경 시 자동으로 이전 캐시 삭제
   - 새 버전의 파일만 캐시에 저장

---

## 🐛 문제 해결

### 사용자가 여전히 구버전을 보는 경우:

1. **Service Worker 강제 업데이트:**
   ```
   개발자 도구 → Application → Service Workers → Unregister
   ```

2. **캐시 완전 삭제:**
   ```
   개발자 도구 → Application → Storage → Clear site data
   ```

3. **브라우저 하드 리프레시:**
   - PC: `Ctrl + Shift + R` (Windows) / `Cmd + Shift + R` (Mac)
   - 모바일: 브라우저 설정 → 캐시 삭제

### 업데이트가 적용되지 않는 경우:

- **확인 1**: `service-worker.js`의 VERSION이 변경되었는지 확인
- **확인 2**: 서버에 파일이 제대로 업로드되었는지 확인
- **확인 3**: 콘솔 로그에서 `[PWA] 새 버전 발견!` 메시지 확인

---

## 📝 버전 히스토리

### v1.0.1 (2024-02-07)
- PWA 캐시 무효화 시스템 구축
- 비디오 로딩 안정성 개선
- 하드웨어 뒤로가기 버튼 제어 추가
- 화면 방향 고정 기능 강화

### v1.0.0 (초기 릴리즈)
- 기본 게임 구현
- 모바일 터치 지원
- 반응형 화면 대응

---

## 💡 팁

- 개발 중에는 브라우저 개발자 도구에서 "Disable cache" 체크
- 테스트는 반드시 **시크릿/프라이빗 모드**에서도 확인
- 사용자에게 "새 버전이 나왔습니다"라는 안내 메시지 표시 가능 (현재는 자동 새로고침)

---

**🎮 업데이트 완료 후 이 파일의 "현재 버전"도 업데이트하는 것을 잊지 마세요!**
