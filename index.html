<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="version" content="1.0.1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ë¬´í˜¼ ë¹„ë™: ì‹œë ¨ì˜ ì‹œì‘</title>
    
    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ë¬´í˜¼ ë¹„ë™">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="ëª¨ë“  ë‚œê´€ì„ ê·¹ë³µí•œ ìë§Œì´ ë¬´í˜¼ì„ ì–»ì„ ê²ƒì´ë‹¤">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- ì•„ì´ì½˜ ì„¤ì • -->
    <link rel="icon" type="image/png" href="assets/common/right_out.png">
    <link rel="apple-touch-icon" href="assets/common/right_out.png">
    <style>
        @font-face {font-family: 'Dokdo'; src: url('assets/common/Dokdo-Regular.ttf') format('truetype'); font-weight: normal; font-style: normal; }
        body { 
            margin: 0; 
            background: #000; 
            overflow: hidden; 
            font-family: 'Dokdo', cursive;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* 16:9 ë¹„ìœ¨ ìœ ì§€ + ìë™ ìŠ¤ì¼€ì¼ë§ ë˜í¼ */
        #gameWrapper {
            position: relative;
            width: 100vw;
            height: 56.25vw; /* 16:9 ë¹„ìœ¨ (9/16 = 56.25%) */
            max-height: 100vh;
            max-width: 177.78vh; /* 16:9 ë¹„ìœ¨ (16/9 = 177.78%) */
            background: #000;
        }
        
        /* ê³µí†µ ì „ì²´ í™”ë©´ ì„¤ì • */
        .screen { 
            width: 1600px; 
            height: 900px; 
            position: absolute; 
            left: 0; 
            top: 0; 
            transform-origin: top left;
            display: none;
        }
        .active { display: block; }

        /* 1. íƒ€ì´í‹€ ë©”ë‰´ í™”ë©´ */
        #titleMenu { background: url('assets/title/bg_title.png') no-repeat center/cover; }
        
        #startBtn { 
            position: absolute;
            left: 25%;
            top: 35%;
            transform: translateX(-50%);
            width: 650px;
            font-size: 80px;
            cursor: pointer;
            transition: 0.3s;
            text-align: center;
            background: rgba(0,0,0,0.5);
            border: none;
            color: #ffffff;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.8);
        }
        #startBtn:hover { 
            transform: translateX(-50%) scale(1.1); 
            color: #fc2828; 
        }

        /* 2. ì»·ì‹  í™”ë©´ */
        #cutsceneVideo { background: #000; }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* [3] ë©”ì‹œì§€ ì˜¤ë²„ë ˆì´ (ì„œì±… ë°°ê²½ í˜•íƒœ) */
        #msgOverlay { background: rgba(0,0,0,0.6); cursor: pointer; } 
        
        .msg-box { 
            position: absolute; 
            left: 50%; 
            top: 50%; 
            transform: translate(-50%, -50%);
            /* â˜… ì„œì±… ì´ë¯¸ì§€ ì„¤ì • */
            width: 1200px; 
            height: 850px; 
            background: url('assets/title/scroll_bg.png') no-repeat center/contain; 
            /* ì´ë¯¸ì§€ ì•ˆìª½ìœ¼ë¡œ í…ìŠ¤íŠ¸ê°€ ë“¤ì–´ì˜¤ë„ë¡ ì—¬ë°± ì¡°ì • */
            padding: 100px 180px; 
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .msg-text { 
            /* â˜… ì„œì±…(ì¢…ì´) ìœ„ì— ì–´ìš¸ë¦¬ëŠ” ì§™ì€ ê°ˆìƒ‰ ê³„ì—´ ê¸€ììƒ‰ */
            color: #2d1b0d; 
            font-size: 50px; 
            line-height: 1.5; 
            white-space: pre-wrap; 
            text-align: center;
            word-break: keep-all;
        }

        .next-hint { 
            position: absolute; 
            bottom: 180px; 
            right: 220px; 
            color: #5d4037; 
            font-size: 30px; 
            animation: blink 1s infinite; 
        }
        
        @keyframes blink { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }
        
        /* ì„¸ë¡œ ëª¨ë“œ ì•ˆë‚´ ë ˆì´ì–´ */
        #rotateOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.98);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: #fff;
            font-family: 'Dokdo', cursive;
        }
        
        #rotateOverlay.show {
            display: flex;
        }
        
        #rotateIcon {
            font-size: 120px;
            margin-bottom: 30px;
            animation: rotateAnim 2s ease-in-out infinite;
        }
        
        #rotateText {
            font-size: 60px;
            color: #00ffcc;
            text-shadow: 0 0 20px #00ffcc;
        }
        
        @keyframes rotateAnim {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(90deg); }
        }
        
        /* ê°€ë¡œ ëª¨ë“œì—ì„œë§Œ ê²Œì„ í‘œì‹œ */
        @media (orientation: portrait) {
            #rotateOverlay {
                display: flex !important;
            }
        }
        
        /* ë’¤ë¡œê°€ê¸° í™•ì¸ íŒì—… */
        #backConfirmOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            font-family: 'Dokdo', cursive;
        }
        
        #backConfirmOverlay.show {
            display: flex;
        }
        
        #backConfirmBox {
            background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
            border: 5px solid #00ffcc;
            border-radius: 20px;
            padding: 50px 60px;
            text-align: center;
            box-shadow: 0 0 40px rgba(0, 255, 204, 0.5);
        }
        
        #backConfirmMessage {
            color: #fff;
            font-size: 70px;
            margin-bottom: 50px;
            text-shadow: 0 0 20px #fff;
        }
        
        #backConfirmButtons {
            display: flex;
            gap: 30px;
            justify-content: center;
        }
        
        .backConfirmBtn {
            padding: 20px 50px;
            font-size: 50px;
            border: 3px solid;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Dokdo', cursive;
            background: rgba(0, 0, 0, 0.5);
        }
        
        #continueBtn {
            color: #00ffcc;
            border-color: #00ffcc;
        }
        
        #continueBtn:hover {
            background: #00ffcc;
            color: #000;
            transform: scale(1.05);
            box-shadow: 0 0 30px #00ffcc;
        }
        
        #exitBtn {
            color: #ff4444;
            border-color: #ff4444;
        }
        
        #exitBtn:hover {
            background: #ff4444;
            color: #fff;
            transform: scale(1.05);
            box-shadow: 0 0 30px #ff4444;
        }
    </style>
</head>
<body>
    <!-- ì„¸ë¡œ ëª¨ë“œ ì•ˆë‚´ ë ˆì´ì–´ -->
    <div id="rotateOverlay">
        <div id="rotateIcon">ğŸ“±âœğŸ®</div>
        <div id="rotateText">ê¸°ê¸°ë¥¼ ê°€ë¡œë¡œ ëŒë ¤ì£¼ì„¸ìš”</div>
    </div>
    
    <!-- ë’¤ë¡œê°€ê¸° í™•ì¸ íŒì—… -->
    <div id="backConfirmOverlay">
        <div id="backConfirmBox">
            <div id="backConfirmMessage">ì•±ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
            <div id="backConfirmButtons">
                <button id="continueBtn" class="backConfirmBtn">ì·¨ì†Œ</button>
                <button id="exitBtn" class="backConfirmBtn">ì¢…ë£Œ</button>
            </div>
        </div>
    </div>
    
    <div id="gameWrapper">
        <div id="titleMenu" class="screen active">
            <div id="startBtn">ë¬´í˜¼ ë¹„ë™ì— ë“¤ì–´ê°„ë‹¤</div>
        </div>

        <div id="cutsceneVideo" class="screen">
            <video id="introVideo" preload="auto" playsinline>
                <source src="assets/title/cutscene_intro.mp4" type="video/mp4">
            </video>
            <div id="videoLoadingIndicator" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #00ffcc; font-size: 60px; font-family: 'Dokdo', cursive;">ë¡œë”© ì¤‘...</div>
        </div>

        <div id="msgOverlay" class="screen">
            <div class="msg-box">
                <div id="msgContent" class="msg-text"></div>
                <div class="next-hint">->></div>
            </div>
        </div>
    </div>

    <script>
        // ë°˜ì‘í˜• ìŠ¤ì¼€ì¼ë§ í•¨ìˆ˜
        function scaleGame() {
            const wrapper = document.getElementById('gameWrapper');
            const screens = document.querySelectorAll('.screen');
            const baseWidth = 1600;
            const baseHeight = 900;
            
            const scaleX = wrapper.offsetWidth / baseWidth;
            const scaleY = wrapper.offsetHeight / baseHeight;
            const scale = Math.min(scaleX, scaleY);
            
            screens.forEach(screen => {
                screen.style.transform = `scale(${scale})`;
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ë° ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ìŠ¤ì¼€ì¼ë§ ì ìš©
        window.addEventListener('load', scaleGame);
        window.addEventListener('resize', scaleGame);
        
    
        const titleMenu = document.getElementById('titleMenu');
        const cutsceneScreen = document.getElementById('cutsceneVideo');
        const introVideo = document.getElementById('introVideo');
        const msgOverlay = document.getElementById('msgOverlay');
        const msgContent = document.getElementById('msgContent');
        const videoLoadingIndicator = document.getElementById('videoLoadingIndicator');

        const introMessages = [
            "[ë¬´í˜¼ ë¹„ë™]\nëª¨ë“  ë‚œê´€ì„ ê·¹ë³µí•œ ìë§Œì´ ë¬´í˜¼ì„ ì–»ì„ ê²ƒì´ë‹¤.",
            "í™”ë©´ì„ ëˆ„ë¥´ë©´ ìƒìŠ¹, ë–¼ë©´ í•˜ê°• í•œë‹¤.",
            "ë°”ë‹¥ì˜ í•¨ì •ê³¼ ë§‰í˜€ìˆëŠ” ì²œì¥ ì‚¬ì´ì—ì„œ,\në‚ ì•„ì˜¤ëŠ” ë¬´ê¸°ë¥¼ í”¼í•˜ì—¬ ë‚œê´€ì„ ëŒíŒŒí•˜ì—¬ì•¼ í•œë‹¤.",
            "í™”ë©´ì„ ëˆ„ë¥´ë©´ ìƒìŠ¹í•˜ê³  ë–¼ë©´ í•˜ê°•í•˜ë©°,\nì§„ê¸°ë¥¼ ì†Œë¹„í•˜ì—¬ ìœ„í—˜ì„ ìë™ íšŒë¹„í•œë‹¤.",
            "ì§„ê¸° í‘œì‹ ë°‘ì˜ í™©ìƒ‰ í‘œì‹ì´\nì§„ê¸°ì˜ ì´ëŸ‰ê³¼ ê°™ì€ ìœ„ì¹˜ì— ë„ë‹¬í•˜ë©´ ë‚œê´€ì´ ëë‚œë‹¤.",
            "ì‹œë ¨ì„ ê·¹ë³µí•˜ê³  ë¬´í˜¼ì„ ì–»ëŠ”ê²ƒì€\nê·¸ëŒ€ì˜ ì†ì— ë‹¬ë ¤ìˆë‹¤."
        ];

        let currentMsgIndex = 0;
        let isVideoReady = false;

        function initNewGame() {
            localStorage.setItem('maxJingi', 8);
            localStorage.setItem('jingiRecoverThreshold', 180);
        }

        // ë¹„ë””ì˜¤ ë¡œë”© ìƒíƒœ í™•ì¸
        introVideo.addEventListener('loadeddata', () => {
            isVideoReady = true;
            console.log('[Video] ë¹„ë””ì˜¤ ë¡œë“œ ì™„ë£Œ');
        });

        // ë¹„ë””ì˜¤ ë¡œë”© ì—ëŸ¬ ì²˜ë¦¬
        introVideo.addEventListener('error', (e) => {
            console.error('[Video] ë¹„ë””ì˜¤ ë¡œë“œ ì‹¤íŒ¨:', e);
            // ë¹„ë””ì˜¤ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ë©”ì‹œì§€ í™”ë©´ìœ¼ë¡œ ë°”ë¡œ ì´ë™
            cutsceneScreen.classList.remove('active');
            msgOverlay.classList.add('active');
            showNextMessage();
        });

        // í„°ì¹˜ ë° í´ë¦­ ëª¨ë‘ ì§€ì›í•˜ëŠ” í•¨ìˆ˜
        function addTouchAndClick(element, handler) {
            element.addEventListener('click', handler);
            element.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handler(e);
            });
        }

        // ë¹„ë””ì˜¤ ì¬ìƒ í•¨ìˆ˜ (ì—ëŸ¬ í•¸ë“¤ë§ í¬í•¨)
        async function playVideoSafely() {
            try {
                videoLoadingIndicator.style.display = 'block';
                
                // ë¹„ë””ì˜¤ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸° (ìµœëŒ€ 5ì´ˆ)
                if (!isVideoReady) {
                    console.log('[Video] ë¹„ë””ì˜¤ ë¡œë”© ëŒ€ê¸° ì¤‘...');
                    await new Promise((resolve, reject) => {
                        const timeout = setTimeout(() => {
                            reject(new Error('Video loading timeout'));
                        }, 5000);
                        
                        const checkReady = () => {
                            if (isVideoReady || introVideo.readyState >= 3) {
                                clearTimeout(timeout);
                                resolve();
                            } else {
                                setTimeout(checkReady, 100);
                            }
                        };
                        checkReady();
                    });
                }
                
                videoLoadingIndicator.style.display = 'none';
                
                // ë¹„ë””ì˜¤ ì¬ìƒ ì‹œë„
                await introVideo.play();
                console.log('[Video] ë¹„ë””ì˜¤ ì¬ìƒ ì‹œì‘');
                
            } catch (error) {
                console.error('[Video] ì¬ìƒ ì‹¤íŒ¨:', error);
                videoLoadingIndicator.style.display = 'none';
                
                // ì¬ìƒ ì‹¤íŒ¨ ì‹œ ë©”ì‹œì§€ í™”ë©´ìœ¼ë¡œ ë°”ë¡œ ì´ë™
                alert('ì»·ì‹  ì¬ìƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.');
                cutsceneScreen.classList.remove('active');
                msgOverlay.classList.add('active');
                showNextMessage();
            }
        }

        addTouchAndClick(document.getElementById('startBtn'), () => {
            initNewGame();
            titleMenu.classList.remove('active');
            cutsceneScreen.classList.add('active');
            playVideoSafely();
        });

        introVideo.onended = () => {
            cutsceneScreen.classList.remove('active');
            msgOverlay.classList.add('active');
            showNextMessage();
        };

        function showNextMessage() {
            if (currentMsgIndex < introMessages.length) {
                msgContent.innerText = introMessages[currentMsgIndex];
                currentMsgIndex++;
            } else {
                window.location.href = 'stage_1.html';
            }
        }

        addTouchAndClick(msgOverlay, showNextMessage);
        
        // ===== ë²„ì „ ì •ë³´ í‘œì‹œ =====
        
        const APP_VERSION = document.querySelector('meta[name="version"]')?.content || 'unknown';
        console.log(`%cğŸ® ë¬´í˜¼ ë¹„ë™ v${APP_VERSION}`, 'font-size: 20px; font-weight: bold; color: #00ffcc;');
        console.log('%cì—…ë°ì´íŠ¸ ë¬¸ì œ ë°œìƒ ì‹œ: VERSION_UPDATE_GUIDE.md ì°¸ê³ ', 'color: #ffcc00;');
        
        // ===== ë¹„ë””ì˜¤ ì‚¬ì „ ë¡œë”© =====
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¹„ë””ì˜¤ ì‚¬ì „ ë¡œë”© ì‹œì‘
        window.addEventListener('DOMContentLoaded', () => {
            console.log('[Video] ë¹„ë””ì˜¤ ì‚¬ì „ ë¡œë”© ì‹œì‘');
            introVideo.load(); // ë¹„ë””ì˜¤ ë¡œë“œ ëª…ì‹œì  í˜¸ì¶œ
        });
        
        // ===== PWA ê¸°ëŠ¥ =====
        
        // 1. ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ë° ìë™ ì—…ë°ì´íŠ¸
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then((registration) => {
                        console.log('[PWA] Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
                        
                        // ì—…ë°ì´íŠ¸ í™•ì¸ (1ì‹œê°„ë§ˆë‹¤)
                        setInterval(() => {
                            registration.update();
                        }, 60 * 60 * 1000);
                        
                        // ìƒˆ Service Workerê°€ ì„¤ì¹˜ë˜ë©´ ìë™ í™œì„±í™”
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('[PWA] ìƒˆ ë²„ì „ ë°œê²¬! ì—…ë°ì´íŠ¸ ì¤‘...');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // ìƒˆ ë²„ì „ì´ ì„¤ì¹˜ë¨ - ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                                    console.log('[PWA] ìƒˆ ë²„ì „ ì„¤ì¹˜ ì™„ë£Œ');
                                    
                                    // ìë™ ìƒˆë¡œê³ ì¹¨ (3ì´ˆ í›„)
                                    setTimeout(() => {
                                        console.log('[PWA] í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ìƒˆ ë²„ì „ ì ìš©');
                                        window.location.reload();
                                    }, 3000);
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.warn('[PWA] Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
                    });
                
                // Service Worker ì œì–´ê¶Œ ë³€ê²½ ê°ì§€ (ìƒˆ ë²„ì „ í™œì„±í™” ì‹œ)
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    console.log('[PWA] Service Worker ì—…ë°ì´íŠ¸ë¨ - ìƒˆë¡œê³ ì¹¨');
                    window.location.reload();
                });
            });
        }
        
        // 2. í™”ë©´ ë°©í–¥ ê°•ì œ ê³ ì • (ê°€ë¡œ ëª¨ë“œ)
        async function lockOrientation() {
            try {
                if (screen.orientation && screen.orientation.lock) {
                    await screen.orientation.lock('landscape');
                    console.log('[PWA] í™”ë©´ ë°©í–¥ ê³ ì •: ê°€ë¡œ ëª¨ë“œ');
                }
            } catch (error) {
                console.warn('[PWA] í™”ë©´ ë°©í–¥ ê³ ì • ì‹¤íŒ¨:', error);
                // CSS ë¯¸ë””ì–´ ì¿¼ë¦¬ë¡œ í´ë°± ì²˜ë¦¬
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°©í–¥ ê³ ì • ì‹œë„
        document.addEventListener('DOMContentLoaded', () => {
            lockOrientation();
        });
        
        // ì „ì²´ í™”ë©´ ëª¨ë“œ ì§„ì… ì‹œ ë°©í–¥ ê³ ì • ì¬ì‹œë„
        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                lockOrientation();
            }
        });
        
        // 3. ì„¸ë¡œ ëª¨ë“œ ê°ì§€ ë° ì•ˆë‚´ ë ˆì´ì–´ í‘œì‹œ
        const rotateOverlay = document.getElementById('rotateOverlay');
        
        function checkOrientation() {
            const isPortrait = window.innerHeight > window.innerWidth;
            if (isPortrait) {
                rotateOverlay.classList.add('show');
            } else {
                rotateOverlay.classList.remove('show');
            }
        }
        
        window.addEventListener('resize', checkOrientation);
        window.addEventListener('orientationchange', checkOrientation);
        checkOrientation(); // ì´ˆê¸° í™•ì¸
        
        // 4. PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ (ì„ íƒì‚¬í•­)
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('[PWA] ì„¤ì¹˜ ê°€ëŠ¥');
        });
        
        // ===== í•˜ë“œì›¨ì–´ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ê°ì§€ ë° ë°©ì§€ =====
        
        const backConfirmOverlay = document.getElementById('backConfirmOverlay');
        const continueBtn = document.getElementById('continueBtn');
        const exitBtn = document.getElementById('exitBtn');
        let isBackConfirmShowing = false;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ íˆìŠ¤í† ë¦¬ ì—”íŠ¸ë¦¬ ì¶”ê°€ (ë’¤ë¡œê°€ê¸° ê°ì§€ìš©)
        history.pushState({ page: 'title' }, '', location.href);
        
        // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ê°ì§€
        window.addEventListener('popstate', (event) => {
            if (!isBackConfirmShowing) {
                // ë’¤ë¡œê°€ê¸°ê°€ ë°œìƒí•˜ë©´ ë‹¤ì‹œ íˆìŠ¤í† ë¦¬ë¥¼ í‘¸ì‹œí•˜ì—¬ í˜ì´ì§€ ìœ ì§€
                history.pushState({ page: 'title' }, '', location.href);
                
                // í™•ì¸ íŒì—… í‘œì‹œ
                isBackConfirmShowing = true;
                backConfirmOverlay.classList.add('show');
            }
        });
        
        // "ì·¨ì†Œ" ë²„íŠ¼
        function handleContinue() {
            backConfirmOverlay.classList.remove('show');
            isBackConfirmShowing = false;
        }
        
        continueBtn.addEventListener('click', handleContinue);
        continueBtn.addEventListener('touchend', (e) => {
            e.preventDefault();
            handleContinue();
        });
        
        // "ì¢…ë£Œ" ë²„íŠ¼ - ì‹¤ì œë¡œ ì•± ì¢…ë£Œ (ë¸Œë¼ìš°ì € íƒ­ ë‹«ê¸° ì‹œë„)
        function handleExit() {
            backConfirmOverlay.classList.remove('show');
            isBackConfirmShowing = false;
            
            // PWAì—ì„œëŠ” window.close()ê°€ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ
            // íˆìŠ¤í† ë¦¬ë¥¼ ì œê±°í•˜ê³  ë¸Œë¼ìš°ì €ì˜ ê¸°ë³¸ ë’¤ë¡œê°€ê¸° ë™ì‘ í—ˆìš©
            history.go(-1);
            
            // í˜¹ì‹œ íˆìŠ¤í† ë¦¬ê°€ ë‚¨ì•„ìˆë‹¤ë©´ ë¹ˆ í˜ì´ì§€ë¡œ ì´ë™í•˜ê±°ë‚˜ ì•± ë‹«ê¸° ì‹œë„
            setTimeout(() => {
                // ë¸Œë¼ìš°ì €ê°€ PWAì¸ ê²½ìš° ì´ ì½”ë“œëŠ” íš¨ê³¼ê°€ ì—†ì„ ìˆ˜ ìˆìŒ
                if (window.matchMedia('(display-mode: standalone)').matches) {
                    // PWA ëª¨ë“œì—ì„œëŠ” ì‚¬ìš©ìê°€ ì§ì ‘ ë‹«ì•„ì•¼ í•¨
                    document.body.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100vh;font-family:Dokdo;font-size:60px;color:#fff;">ì•±ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br>í™”ë©´ì„ ë‹«ì•„ì£¼ì„¸ìš”.</div>';
                } else {
                    window.close();
                }
            }, 10);
        }
        
        exitBtn.addEventListener('click', handleExit);
        exitBtn.addEventListener('touchend', (e) => {
            e.preventDefault();
            handleExit();
        });
    </script>
</body>
</html>