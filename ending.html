<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë¬´í˜¼ ë¹„ë™: ì „ì„¤ì˜ ì‹œì‘</title>
    
    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">
    <style>
        @font-face {font-family: 'Dokdo'; src: url('assets/common/Dokdo-Regular.ttf') format('truetype'); font-weight: normal; font-style: normal; }
        body { 
            margin: 0; 
            background: #000; 
            overflow: hidden; 
            font-family: 'Dokdo', cursive;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* 16:9 ë¹„ìœ¨ ìœ ì§€ ë˜í¼ */
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 56.25vw; /* 16:9 */
            max-height: 100vh;
            max-width: 177.78vh; /* 16:9 */
            background: #000;
        }
        
        #endingWrapper { 
            width: 1600px; 
            height: 900px; 
            position: absolute; 
            left: 0; 
            top: 0; 
            transform-origin: top left;
            overflow: hidden;
            background: #000;
        }

        /* â˜… [ì¶”ê°€] íƒˆì¶œ ì„±ê³µ ì˜¤ë²„ë ˆì´: í´ë¦­ ìœ ë„ìš© */
        #escapeOverlay {
            position: absolute; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; cursor: pointer;
        }
        #escapeMsg { color: #fff; font-size: 120px; text-shadow: 0 0 20px #00ffcc; margin-bottom: 20px; }
        #clickHint { color: #888; font-size: 40px; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }

        #endingVideo {
            position: absolute; width: 100%; height: 100%; object-fit: cover;
            z-index: 20; display: none; /* ì²˜ìŒì—” ìˆ¨ê¹€ */
        }

        #endingBG {
            position: absolute; width: 100%; height: 100%;
            background: url('assets/ending/bg_ending.png') no-repeat center/cover;
            opacity: 0; transition: opacity 2s;
            z-index: 1;
        }

        #credits {
            position: absolute; width: 100%; text-align: center; color: white; 
            font-size: 60px; line-height: 1.8;
            text-shadow: 4px 4px 15px rgba(0, 0, 0, 1), -4px -4px 15px rgba(0, 0, 0, 1);
            top: 950px;
            z-index: 10;
            display: none;
        }

        .start-scroll {
            animation: rollUp 20s linear forwards; 
        }

        @keyframes rollUp {
            0% { top: 600px; } 
            100% { top: -2000px; } 
        }

        #restartBtn {
            position: absolute; left: 50%; top: 75%; transform: translate(-50%, -50%);
            padding: 25px 70px; background: rgba(0,0,0,0.8); color: #fff;
            border: none; cursor: pointer; font-size: 60px; font-family: 'Dokdo';
            display: none; text-shadow: 2px 2px 10px rgba(0,0,0,0.8);
            transition: 0.3s;
            z-index: 30;
        }
        #restartBtn:hover { color: #fc2828; transform: translate(-50%, -50%) scale(1.1); }
        
        /* ì„¸ë¡œ ëª¨ë“œ ì•ˆë‚´ ë ˆì´ì–´ */
        #rotateOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.98);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: #fff;
            font-family: 'Dokdo', cursive;
        }
        
        #rotateIcon {
            font-size: 120px;
            margin-bottom: 30px;
            animation: rotateAnim 2s ease-in-out infinite;
        }
        
        #rotateText {
            font-size: 60px;
            color: #ffcc00;
            text-shadow: 0 0 20px #ffcc00;
        }
        
        @keyframes rotateAnim {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(90deg); }
        }
        
        @media (orientation: portrait) {
            #rotateOverlay {
                display: flex !important;
            }
        }
    </style>
</head>
<body>
    <!-- ì„¸ë¡œ ëª¨ë“œ ì•ˆë‚´ ë ˆì´ì–´ -->
    <div id="rotateOverlay">
        <div id="rotateIcon">ğŸ“±âœğŸ®</div>
        <div id="rotateText">ê¸°ê¸°ë¥¼ ê°€ë¡œë¡œ ëŒë ¤ì£¼ì„¸ìš”</div>
    </div>
    
    <div id="gameContainer">
        <div id="endingWrapper">
        <div id="escapeOverlay">
            <div id="escapeMsg">"íƒˆì¶œì´ë‹¤!"</div>
            <div id="clickHint">...</div>
        </div>

        <video id="endingVideo" src="assets/ending/ending_cutscene.mp4"></video>
        
        <div id="endingBG"></div>

        <div id="credits">
            <p style="font-size: 110px; color: #ffcc00; margin-top: 200px; margin-bottom: 150px;">- ì „ì„¤ì˜ ì‹œì‘ -</p>
            <p>ìˆ˜ë§ì€ ì¹¼ë‚ ê³¼ ë„ë¼ì˜ ë¹„ë¥¼ ëš«ê³ </p>
            <p>ê·¸ëŒ€ëŠ” ë§ˆì¹¨ë‚´ ë¬´í˜¼ì˜ í˜ì„ ì†ì— ë„£ì—ˆë„ë‹¤.</p>
            <br>
            <p style="color: #00ffcc; font-size: 70px;">[ ê°œë°œ ê¸°ë¡ ]</p>
            <p>ê¸°íš ë° ì´ê´„ : ì •ìˆ˜</p>
            <p>ê¸°ìˆ  ì§€ì› ë° ì¡°ë ¥ : ê¹ëŒì´</p>            
            <p style="font-size: 45px; color: #ffffff;">Â© 2026 ë¬´í˜¼ ë¹„ë™ í”„ë¡œì íŠ¸</p>
            <p style="font-size:45px; color: #ffffff;">ê°ì‚¬í•©ë‹ˆë‹¤.</p>
        </div>

        <button id="restartBtn" onclick="location.href='index.html'">ë¬´í˜¼ ë¹„ë™ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </div>

    <script>
        // ë°˜ì‘í˜• ìŠ¤ì¼€ì¼ë§ í•¨ìˆ˜
        function scaleGame() {
            const container = document.getElementById('gameContainer');
            const wrapper = document.getElementById('endingWrapper');
            const baseWidth = 1600;
            const baseHeight = 900;
            
            const scaleX = container.offsetWidth / baseWidth;
            const scaleY = container.offsetHeight / baseHeight;
            const scale = Math.min(scaleX, scaleY);
            
            wrapper.style.transform = `scale(${scale})`;
        }
        
        // í˜ì´ì§€ ë¡œë“œ ë° ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ìŠ¤ì¼€ì¼ë§ ì ìš©
        window.addEventListener('load', scaleGame);
        window.addEventListener('resize', scaleGame);
        
    
        const overlay = document.getElementById('escapeOverlay');
        const video = document.getElementById('endingVideo');
        const bg = document.getElementById('endingBG');
        const credits = document.getElementById('credits');
        const restartBtn = document.getElementById('restartBtn');

        // â˜… 1. ì˜¤ë²„ë ˆì´ í´ë¦­ ë° í„°ì¹˜ ì‹œ ì˜ìƒ ì¬ìƒ ì‹œì‘
        function startEndingVideo() {
            overlay.style.display = 'none'; // ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
            video.style.display = 'block'; // ì˜ìƒ ë³´ì´ê¸°
            video.play();                  // ì˜ìƒ ì¬ìƒ
        }
        
        overlay.addEventListener('click', startEndingVideo);
        overlay.addEventListener('touchstart', (e) => {
            e.preventDefault();
            startEndingVideo();
        });

        // 2. ì˜ìƒ ì¢…ë£Œ ì‹œ í¬ë ˆë”§ ì‹œì‘
        video.onended = () => {
            video.style.display = 'none';
            bg.style.opacity = '1';
            credits.style.display = 'block';
            credits.classList.add('start-scroll');
        };

        // 3. í¬ë ˆë”§ ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ ì‹œ ë²„íŠ¼ ë“±ì¥
        credits.addEventListener('animationend', () => {
            restartBtn.style.display = 'block';
            restartBtn.animate([
                { opacity: 0, transform: 'translate(-50%, -50%) scale(0.8)' },
                { opacity: 1, transform: 'translate(-50%, -50%) scale(1)' }
            ], {
                duration: 1000,
                easing: 'ease-out',
                fill: 'forwards'
            });
        });
        
        // ===== PWA í™”ë©´ ë°©í–¥ ì œì–´ =====
        async function lockOrientation() {
            try {
                if (screen.orientation && screen.orientation.lock) {
                    await screen.orientation.lock('landscape');
                }
            } catch (error) {
                console.warn('[PWA] í™”ë©´ ë°©í–¥ ê³ ì • ì‹¤íŒ¨:', error);
            }
        }
        
        lockOrientation();
        
        const rotateOverlay = document.getElementById('rotateOverlay');
        function checkOrientation() {
            const isPortrait = window.innerHeight > window.innerWidth;
            rotateOverlay.style.display = isPortrait ? 'flex' : 'none';
        }
        
        window.addEventListener('resize', checkOrientation);
        window.addEventListener('orientationchange', () => {
            checkOrientation();
            lockOrientation();
        });
        checkOrientation();
    </script>
</body>
</html>